if [[ $DOTS_OS == Darwin && -r /etc/zshrc ]]; then
    source '/etc/zshrc'
fi

typeset -xU fpath FPATH
fpath=(
    "$ZDOTDIR/functions"(N-/)
    "$NIX_DATA_DIR/zsh/site-functions"(N-/)
    '/nix/var/nix/profiles/default/share/zsh/site-functions'(N-/)
    $fpath
)

source "$XDG_CONFIG_HOME/_b-shell/env_interactive.sh"

source "$ZDOTDIR/rc/directories.zsh"
source "$ZDOTDIR/rc/options.zsh"
source "$ZDOTDIR/rc/prompt.zsh"

# zsh-defer dummy
autoload -Uz _zsh-defer-dummy
zsh-defer() { _zsh-defer-dummy "$@"; }

# sheldon
source "$XDG_CONFIG_HOME/_b-shell/plugins.sh"

# ===== Delayed loading from here down =====

zsh-defer -p source "$ZDOTDIR/rc/alias.zsh"
zsh-defer -p source "$ZDOTDIR/rc/bindkey.zsh"
zsh-defer -p source "$ZDOTDIR/rc/completion.zsh"
zsh-defer -p source "$ZDOTDIR/rc/functions.zsh"

# zoxide
type zoxide &>/dev/null && zsh-defer -p -c 'eval "$(zoxide init zsh --hook pwd)"'

zsh-defer -p ensure_zcompiled "$ZDOTDIR/.zshrc"
zsh-defer -p unset -f ensure_zcompiled source

# zprof | less
